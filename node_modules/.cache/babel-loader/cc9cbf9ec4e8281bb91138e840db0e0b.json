{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Session = void 0;\n\nconst js_sha256_1 = require(\"js-sha256\");\n\nconst rxjs_1 = require(\"rxjs\");\n\nconst operators_1 = require(\"rxjs/operators\");\n\nconst util_1 = require(\"../util\");\n\nconst STORAGE_KEY_SESSION_ID = \"session:id\";\nconst STORAGE_KEY_SESSION_SECRET = \"session:secret\";\nconst STORAGE_KEY_SESSION_LINKED = \"session:linked\";\n\nclass Session {\n  constructor(storage, id, secret, linked) {\n    this._storage = storage;\n    this._id = id || (0, util_1.randomBytesHex)(16);\n    this._secret = secret || (0, util_1.randomBytesHex)(32);\n    const hash = js_sha256_1.sha256.create();\n    hash.update(`${this._id}, ${this._secret} WalletLink`);\n    this._key = hash.hex();\n    this._linked = !!linked;\n  }\n\n  static load(storage) {\n    const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n    const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n    const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n\n    if (id && secret) {\n      return new Session(storage, id, secret, linked === \"1\");\n    }\n\n    return null;\n  }\n\n  static get persistedSessionIdChange$() {\n    return (0, rxjs_1.fromEvent)(window, \"storage\").pipe((0, operators_1.filter)(evt => evt.key === STORAGE_KEY_SESSION_ID), (0, operators_1.map)(evt => ({\n      oldValue: evt.oldValue || null,\n      newValue: evt.newValue || null\n    })));\n  }\n  /**\r\n   * Takes in a session ID and returns the sha256 hash of it.\r\n   * @param sessionId session ID\r\n   */\n\n\n  static hash(sessionId) {\n    const hash = js_sha256_1.sha256.create();\n    return hash.update(sessionId).hex();\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get secret() {\n    return this._secret;\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  get linked() {\n    return this._linked;\n  }\n\n  set linked(val) {\n    this._linked = val;\n    this.persistLinked();\n  }\n\n  save() {\n    this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n\n    this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n\n    this.persistLinked();\n    return this;\n  }\n\n  persistLinked() {\n    this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\n  }\n\n}\n\nexports.Session = Session;","map":{"version":3,"sources":["E:/Freelancing/blockchain/time-warriors-mint-page/node_modules/walletlink/dist/relay/Session.js"],"names":["Object","defineProperty","exports","value","Session","js_sha256_1","require","rxjs_1","operators_1","util_1","STORAGE_KEY_SESSION_ID","STORAGE_KEY_SESSION_SECRET","STORAGE_KEY_SESSION_LINKED","constructor","storage","id","secret","linked","_storage","_id","randomBytesHex","_secret","hash","sha256","create","update","_key","hex","_linked","load","getItem","persistedSessionIdChange$","fromEvent","window","pipe","filter","evt","key","map","oldValue","newValue","sessionId","val","persistLinked","save","setItem"],"mappings":"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","sourcesContent":["\"use strict\";\r\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\r\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\r\n// Licensed under the Apache License, version 2.0\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Session = void 0;\r\nconst js_sha256_1 = require(\"js-sha256\");\r\nconst rxjs_1 = require(\"rxjs\");\r\nconst operators_1 = require(\"rxjs/operators\");\r\nconst util_1 = require(\"../util\");\r\nconst STORAGE_KEY_SESSION_ID = \"session:id\";\r\nconst STORAGE_KEY_SESSION_SECRET = \"session:secret\";\r\nconst STORAGE_KEY_SESSION_LINKED = \"session:linked\";\r\nclass Session {\r\n    constructor(storage, id, secret, linked) {\r\n        this._storage = storage;\r\n        this._id = id || (0, util_1.randomBytesHex)(16);\r\n        this._secret = secret || (0, util_1.randomBytesHex)(32);\r\n        const hash = js_sha256_1.sha256.create();\r\n        hash.update(`${this._id}, ${this._secret} WalletLink`);\r\n        this._key = hash.hex();\r\n        this._linked = !!linked;\r\n    }\r\n    static load(storage) {\r\n        const id = storage.getItem(STORAGE_KEY_SESSION_ID);\r\n        const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\r\n        const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\r\n        if (id && secret) {\r\n            return new Session(storage, id, secret, linked === \"1\");\r\n        }\r\n        return null;\r\n    }\r\n    static get persistedSessionIdChange$() {\r\n        return (0, rxjs_1.fromEvent)(window, \"storage\").pipe((0, operators_1.filter)(evt => evt.key === STORAGE_KEY_SESSION_ID), (0, operators_1.map)(evt => ({\r\n            oldValue: evt.oldValue || null,\r\n            newValue: evt.newValue || null\r\n        })));\r\n    }\r\n    /**\r\n     * Takes in a session ID and returns the sha256 hash of it.\r\n     * @param sessionId session ID\r\n     */\r\n    static hash(sessionId) {\r\n        const hash = js_sha256_1.sha256.create();\r\n        return hash.update(sessionId).hex();\r\n    }\r\n    get id() {\r\n        return this._id;\r\n    }\r\n    get secret() {\r\n        return this._secret;\r\n    }\r\n    get key() {\r\n        return this._key;\r\n    }\r\n    get linked() {\r\n        return this._linked;\r\n    }\r\n    set linked(val) {\r\n        this._linked = val;\r\n        this.persistLinked();\r\n    }\r\n    save() {\r\n        this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\r\n        this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\r\n        this.persistLinked();\r\n        return this;\r\n    }\r\n    persistLinked() {\r\n        this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\r\n    }\r\n}\r\nexports.Session = Session;\r\n"]},"metadata":{},"sourceType":"script"}